应用层 :http

传输层:tcp 提供接口

网络层：ip

链路层：硬件接口



Socket 套接字

通过tcp建立连接

客户端和服务端通过一个ip地址和端口进行通信，

每个TCP的Socket的内核中都有一个发送缓冲区和一个接收缓冲区



丢包问题

客户端向服务端发送一个数据，如果丢包了，那么客户端在指定的时间内收到收到服务器的应答，那么就会重新发送一个同样的包给服务器，直到服务器收到为止。

一次完整的http请求

首先进行dns域名解析

1，三次握手建立tcp连接

2，客户端向服务器发送请求命令，比如get请求

3，客户端发送请求头信息

4，服务器应答 200/ok

5，服务器返回头信息

6，服务器向客户端发送数据

7，关闭tcp连接



对比缓存：客户端将一个缓存标识发送给服务器，如果这个标识变化了，就返回数据，否则就返回304.使用缓存的数据

强制缓存：服务器返回给客户端一个时间，当当前时间小于这个到期时间的时候就用缓存的数据，这是HTTP1.1（现在基本不怎么用了）

last-modified  if-modified-since用来做对比缓存

服务器返回数据的时候，会告诉你last-modified

当你再次请求的时候 对比 if-modified-since和last-modified对比，返回对应的数据

etag 资源在服务器的唯一标识uuid 当这个etag变化的时候，就说明资源已经被修改

![image-20200522101946383](/Users/yanzhe/android/知识整理/image/image-20200522101946383.png)





https单向认证

1，客户端发送ssl版本信息给服务器

2，服务器返回ssl证书， 以及服务器公钥

3，客户端校验证书合法性。发送客户端支持的加密方式

4，服务端选择加密方式返回给客户端

5，客户端收到加密方式后，生成随机码。作为对称加密的秘钥，并且用服务器公钥传输给服务器

6，服务器使用私钥解密，获取对称加密的秘钥，后续通过这个秘钥通信



https双向认证

1，客户端发送ssl版本信息给服务器

2，服务器返回ssl证书， 以及服务器公钥

3，客户端校验证书合法性。将自己的证书和公钥发送给服务器

4，服务器对客户端证书进行检验，检验结束后获得客户端公钥

5，客户端发送客户端支持的加密方式

6，服务器选择加密方式。使用客户端公钥加密后，发送给客户端

7，客户端私钥解密，获取加密方式，生成随机码。作为对称加密的秘钥，并且用服务器公钥传输给服务器

8，服务器使用私钥解密，获取对称加密的秘钥，后续通过这个秘钥通信



对称加密的优点是加解密效率高，而我们在网络上传输数据是非常讲究效率的

防止对称加密的秘钥泄漏，使用非对称加密进行这个秘钥的传输，过程如下：



网站首先向CA机构申请证书（证书内容包括网站的公钥，域名，有效时长），提供自己的公钥，证书申请完成之后，ca机构用自己的私钥对这个证书加密，网站将这个加密的数据配置到网站服务器上

每当有浏览器请求我们的网站时，网站会先将CA机构私钥加密的数据（这个数据包含网站的公钥）返回给浏览器。

浏览器查询内置的信任的ca公钥证书，将数据解密，拿到网站的公钥。

接下来浏览器随机生成一个对称加密算法的秘钥，使用网站的公钥对这个秘钥进行加密发送给网站

网站用自己的私钥解密获取浏览器随机生成的秘钥，后续俩个人通过这个秘钥进行对称加密数据传输



